<h1>User Profile</h1>

<%= link_to "Back to Home", root_path, class: "btn btn-primary" %>

<div class="user-info">
  <p> Username: <%= @user.email.split('@').first %> </p>
  <p> Email: <%= @user.email %> </p>
  <p> Joined: <%= @user.created_at %></p>
</div>

<div class="order-history">
  <h2>Order History</h2>
  <% @user.orders.each do |order| %>
    <div class="order">
      <p>Order ID: <%= order.id %></p>
      <p>Total: <%= number_to_currency(order.total) %></p>
    </div>
  <% end %>
</div>

<% unless @user.seller? %>
  <%= link_to "Become a Seller", become_seller_user_path(@user), method: :post, class: "btn btn-primary" %>
<% end %>

<% if @user.seller? %>
  <div class="seller-history">
    <h2>Active Listings</h2>
    <ul>
      <% active_listings = @user.listings.where(is_sold: false) %>
      <% if active_listings.any? %>
        <% active_listings.each do |listing| %>
          <li>
            <p> Item: <%= listing.name %> </p>
          </li>
        <% end %>
      <% else %>
        <li>
          <p>No active listings</p>
        </li>
      <% end %>
    </ul>

    <h2>Sold Listings</h2>
    <ul>
      <% sold_listings = @user.listings.where(is_sold: true) %>
      <% if sold_listings.any? %>
        <% sold_listings.each do |listing| %>
          <li>
            <p> Item: <%= listing.name %> </p>
          </li>
        <% end %>
      <% else %>
        <li>
          <p>No sold listings</p>
        </li>
      <% end %>
    </ul>
  </div>
<% end %>